# comments
→ redirects to
B response body: line or block
\ doesn't change onward referrers
: x-www-form-urlencoded row
R referrer of the next request

R https://tw.beanfun.com/
GET https://tw.beanfun.com/
\ GET https://tw.beanfun.com/beanfun_block/loader.ashx?service_code=999999&service_region=T0&ssl=yes
GET https://tw.beanfun.com/beanfun_block/bflogin/default.aspx?service=999999_T0&dt=20220318130314.843&url=https://tw.beanfun.com/
→ https://tw.newlogin.beanfun.com/checkin.aspx?skey=...&display_mode=0
→ https://tw.newlogin.beanfun.com/checkin_step2.aspx?skey=...&display_mode=2
B var strSessionKey = "...";var strClientID = "";var strDisplayMode = "2";
R https://tw.newlogin.beanfun.com/
\ GET https://tw.beanfun.com/beanfun_block/scripts/BeanFunBlockParams.ashx
\ GET https://tw.newlogin.beanfun.com/checkin_step2.aspx?skey=...&display_mode=2&_=1647583815845
GET https://tw.newlogin.beanfun.com/loginform.aspx?skey=...&display_mode=2
B 
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="..." />
B <input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="..." />
\ GET https://tw.newlogin.beanfun.com/loginform.aspx?skey=...&display_mode=2&_=1647579796357
\ GET https://tw.newlogin.beanfun.com/login/id-pass_form.aspx?skey=...&clientID=undefined
B <script src="/WebResource.axd?d=...&amp;t=..." type="text/javascript"></script>
B <script src="/WebResource.axd?d=...&amp;t=..." type="text/javascript"></script>
\ GET https://tw.newlogin.beanfun.com/WebResource.axd?d=...&t=...
\ GET https://tw.newlogin.beanfun.com/WebResource.axd?d=...&t=...
POST https://tw.newlogin.beanfun.com/loginform.aspx?skey=...&display_mode=2
: __EVENTTARGET=__Page
: __EVENTARGUMENT=SwitchToLocalAreaQR
: __VIEWSTATE=...
: __VIEWSTATEGENERATOR=...
: ddlAuthType=1
→ https://tw.newlogin.beanfun.com/loginform.aspx?skey=...&display_mode=2&region=qr
\ GET https://tw.newlogin.beanfun.com/loginform.aspx?skey=...&display_mode=2&region=qr&_=1647737805547
GET https://tw.newlogin.beanfun.com/login/qr_form.aspx?skey=...&clientID=undefined
B <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="..." />
B
<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="..." />
<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="..." />
B $("#theQrCodeImg").attr("src", "../qrhandler.ashx?u=https://beanfunstor.blob.core.windows.net/redirect/appCheck.html?url=beanfunapp://Q/gameLogin/gtw/" + obj.strEncryptData);
\ GET https://tw.newlogin.beanfun.com/generic_handlers/get_qrcodeData.ashx?skey=...&startGame=&clientID=
B {"intResult":1,"strResult":"success","strEncryptData":"...","strEncryptBCDOData":"..."}

# Check qr code
loop
  \ POST https://tw.newlogin.beanfun.com/generic_handlers/CheckLoginStatus.ashx
  : status=...
  B {"ResultData":null,"Result":0,"ResultMessage":"Failed"}
  B {"ResultData":null,"Result":0,"ResultMessage":"Token Expired"}
  B {"ResultData":null,"Result":1,"ResultMessage":"Success"}

# Expired (broken)
POST https://tw.newlogin.beanfun.com/login/qr_form.aspx?skey=...&clientID=undefined
: Refresh.x=0~250
: Refresh.y=0~250
: __VIEWSTATE=...
: __VIEWSTATEGENERATOR=...
: __EVENTVALIDATION=...
B <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="..." />
B
<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="..." />
<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="..." />
B $("#theQrCodeImg").attr("src", "../qrhandler.ashx?u=https://beanfunstor.blob.core.windows.net/redirect/appCheck.html?url=beanfunapp://Q/gameLogin/gtw/" + obj.strEncryptData);
\ GET https://tw.newlogin.beanfun.com/generic_handlers/get_qrcodeData.ashx?skey=...&startGame=&clientID=
B {"intResult":0,"strResult":"success","strEncryptData":"...","strEncryptBCDOData":"..."}

# Successful
GET https://tw.newlogin.beanfun.com/login/qr_step2.aspx?skey=...
B RedirectPage("","./final_step.aspx?akey=...&authkey=N&bfapp=1") ;
GET https://tw.newlogin.beanfun.com/login/final_step.aspx?akey=...&authkey=N&bfapp=1
C bfWebToken=...; domain=.beanfun.com; path=/; secure; HttpOnly
B var bfSecretCode = "...";
B var strWriteUrl = "https://tw.beanfun.com/beanfun_block/bflogin/handle_writecookie.ashx?t=...&d=...";
B
parent.document.forms["frmGoBack"].AuthKey.value = "...";parent.document.forms["frmGoBack"].SessionKey.value = "...";parent.document.forms["frmGoBack"].ServiceCode.value = "";parent.document.forms["frmGoBack"].ServiceRegion.value = "";parent.document.forms["frmGoBack"].ServiceAccountSN.value = "0";parent.document.forms["frmGoBack"].action = "https://tw.beanfun.com/beanfun_block/bflogin/return.aspx";
R https://tw.newlogin.beanfun.com/
GET https://tw.beanfun.com/beanfun_block/bflogin/handle_writecookie.ashx?t=...&d=...&callback=jQuery...&_=1647580942369
B jQuery...({ "Result":1,"ResultMessage":"呼叫成功"})
R https://tw.newlogin.beanfun.com/
POST https://tw.beanfun.com/beanfun_block/bflogin/return.aspx
: SessionKey=...
: AuthKey=...
: ServiceCode=
: ServiceRegion=
: ServiceAccountSN=0
→ https://tw.beanfun.com/
\ GET https://tw.beanfun.com/beanfun_block/loader.ashx?service_code=999999&service_region=T0&ssl=yes